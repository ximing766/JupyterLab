# 剪刀石头布游戏应用说明文档

## 1. 项目概述

这是一个基于 Android Kotlin + Jetpack Compose 开发的剪刀石头布游戏应用，采用 MVVM 架构模式，支持音效、动画和电子宠物功能。

## 2. 技术栈

* **开发语言**: Kotlin

* **UI框架**: Jetpack Compose + Material3

* **架构模式**: MVVM (Model-View-ViewModel)

* **本地存储**: SharedPreferences + Room Database

* **音频处理**: MediaPlayer + SoundPool

* **动画系统**: Compose Animation APIs

* **最低SDK版本**: 31

* **目标SDK版本**: 34

## 3. 项目文件结构

### 3.1 根目录结构

```
NTAG_APP/
├── app/                          # 主应用模块
├── gradle/                       # Gradle 配置文件
├── build.gradle.kts             # 项目级构建配置
├── settings.gradle.kts          # 项目设置
└── gradle.properties           # Gradle 属性配置
```

### 3.2 应用模块结构 (app/)

```
app/
├── src/main/
│   ├── AndroidManifest.xml      # 应用清单文件
│   ├── java/com/example/ntagapp/ # 源代码目录
│   └── res/                     # 资源文件目录
├── build.gradle.kts             # 应用级构建配置
└── proguard-rules.pro          # 代码混淆规则
```

## 4. 源代码文件层级与功能说明

### 4.1 主入口

* **MainActivity.kt** - 应用主活动，负责初始化 Compose UI 和导航

### 4.2 数据层 (data/)

```
data/
├── dao/
│   └── GameRecordDao.kt         # 游戏记录数据访问对象
├── database/
│   └── GameDatabase.kt          # Room 数据库配置
└── entity/
    └── GameRecordEntity.kt      # 游戏记录实体类
```

### 4.3 模型层 (model/)

```
model/
├── AppSettings.kt               # 应用设置数据类
├── GameChoice.kt               # 游戏选择枚举 (石头/剪刀/布)
├── GameRecord.kt               # 游戏记录数据类
├── GameResult.kt               # 游戏结果枚举 (胜/负/平)
├── GameState.kt                # 游戏状态数据类
├── GameStatistics.kt           # 游戏统计数据类
└── PetType.kt                  # 宠物类型枚举
```

### 4.4 仓库层 (repository/)

```
repository/
├── GameRepository.kt           # 游戏数据仓库，处理游戏记录的增删改查
└── SettingsRepository.kt      # 设置数据仓库，管理应用设置
```

### 4.5 视图模型层 (viewmodel/)

```
viewmodel/
├── GameViewModel.kt            # 游戏页面视图模型，管理游戏状态和逻辑
├── SettingsViewModel.kt        # 设置页面视图模型，管理设置状态
└── StatisticsViewModel.kt      # 统计页面视图模型，管理统计数据
```

### 4.6 UI层 (ui/)

```
ui/
├── components/                 # 可复用UI组件
│   ├── BottomNavigationBar.kt  # 底部导航栏组件
│   ├── DraggablePet.kt        # 可拖拽宠物组件
│   └── GameComponents.kt       # 游戏相关UI组件
├── screens/                    # 页面组件
│   ├── GameScreen.kt          # 游戏主页面
│   ├── SettingsScreen.kt      # 设置页面
│   └── StatisticsScreen.kt    # 统计页面
└── theme/                     # 主题配置
    ├── Color.kt               # 颜色定义
    ├── Theme.kt               # 主题配置
    └── Type.kt                # 字体样式定义
```

### 4.7 导航层 (navigation/)

```
navigation/
├── AppNavigation.kt           # 应用导航配置
└── NavigationItem.kt          # 导航项数据类
```

### 4.8 功能模块

```
├── animation/
│   └── AnimationManager.kt    # 动画管理器，处理游戏动画效果
├── audio/
│   └── AudioManager.kt        # 音频管理器，处理音效播放
├── game/
│   └── GameLogic.kt          # 游戏逻辑处理
└── logic/
    └── GameLogic.kt          # 游戏逻辑处理 (重复文件)
```

## 5. 资源文件说明

### 5.1 图标资源 (res/drawable/)

```
drawable/
├── ic_launcher_background.xml   # 应用图标背景
├── ic_launcher_foreground.xml   # 应用图标前景
├── ic_paper.xml                # 布的图标
├── ic_rock.xml                 # 石头的图标
├── ic_scissors.xml             # 剪刀的图标
├── ic_pet_cat.xml              # 猫宠物图标
├── ic_pet_default.xml          # 默认宠物图标
├── ic_pet_dog.xml              # 狗宠物图标
└── ic_pet_robot.xml            # 机器人宠物图标
```

### 5.2 音频资源 (res/raw/)

```
raw/
├── background_music.mp3        # 背景音乐
├── click_sound.mp3            # 点击音效
├── draw_sound.mp3             # 平局音效
├── lose_sound.mp3             # 失败音效
├── thinking_sound.mp3         # 思考音效
└── win_sound.mp3              # 胜利音效
```

### 5.3 配置资源

```
values/
├── colors.xml                 # 颜色资源定义
├── strings.xml                # 字符串资源定义
└── themes.xml                 # 主题样式定义

xml/
├── backup_rules.xml           # 备份规则配置
└── data_extraction_rules.xml  # 数据提取规则配置
```

## 6. 页面功能说明

### 6.1 游戏页面 (GameScreen)

* 显示剪刀石头布游戏界面

* 用户选择游戏手势

* 显示电脑选择和游戏结果

* 集成电子宠物角色

* 播放相应音效和动画

### 6.2 设置页面 (SettingsScreen)

* 音效开关控制

* 宠物类型选择

* 游戏规则说明

* 其他应用设置

### 6.3 统计页面 (StatisticsScreen)

* 显示游戏总局数

* 胜负平统计

* 胜率计算

* 最长连胜记录

* 游戏历史记录

## 7. 数据模型定义

### 7.1 游戏相关数据类

```kotlin
// 游戏选择枚举
enum class GameChoice {
    ROCK, PAPER, SCISSORS
}

// 游戏结果枚举
enum class GameResult {
    WIN, LOSE, DRAW
}

// 游戏状态数据类
data class GameState(
    val userChoice: GameChoice? = null,
    val deviceChoice: GameChoice? = null,
    val result: GameResult? = null,
    val isLoading: Boolean = false,
    val score: Int = 0
)

// 游戏记录数据类
data class GameRecord(
    val id: Long = 0,
    val userChoice: GameChoice,
    val deviceChoice: GameChoice,
    val result: GameResult,
    val timestamp: Long = System.currentTimeMillis()
)

// 游戏统计数据类
data class GameStatistics(
    val totalGames: Int = 0,
    val wins: Int = 0,
    val losses: Int = 0,
    val draws: Int = 0,
    val winRate: Float = 0f,
    val maxWinStreak: Int = 0
)
```

### 7.2 设置相关数据类

```kotlin
// 应用设置数据类
data class AppSettings(
    val soundEnabled: Boolean = true,
    val petEnabled: Boolean = true,
    val selectedPetType: PetType = PetType.DEFAULT
)

// 宠物类型枚举
enum class PetType {
    DEFAULT, CAT, DOG, ROBOT
}
```

### 7.3 数据库实体

```kotlin
// Room Database Entity
@Entity(tableName = "game_records")
data class GameRecordEntity(
    @PrimaryKey(autoGenerate = true)
    val id: Long = 0,
    @ColumnInfo(name = "user_choice")
    val userChoice: String,
    @ColumnInfo(name = "device_choice")
    val deviceChoice: String,
    val result: String,
    val timestamp: Long
)
```

## 8. 构建配置说明

### 8.1 项目依赖 (build.gradle.kts)

```kotlin
dependencies {
    // Android Core
    implementation("androidx.core:core-ktx:1.10.1")
    implementation("androidx.lifecycle:lifecycle-runtime-ktx:2.6.1")
    implementation("androidx.activity:activity-compose:1.8.0")
    
    // Compose BOM
    implementation(platform("androidx.compose:compose-bom:2024.04.01"))
    implementation("androidx.compose.ui:ui")
    implementation("androidx.compose.ui:ui-graphics")
    implementation("androidx.compose.ui:ui-tooling-preview")
    implementation("androidx.compose.material3:material3")
    
    // Room Database
    implementation("androidx.room:room-runtime:2.5.0")
    implementation("androidx.room:room-ktx:2.5.0")
    kapt("androidx.room:room-compiler:2.5.0")
    
    // Navigation
    implementation("androidx.navigation:navigation-compose:2.7.0")
    
    // ViewModel
    implementation("androidx.lifecycle:lifecycle-viewmodel-compose:2.6.1")
}
```

### 8.2 编译配置

* **编译SDK版本**: 34

* **最低SDK版本**: 31

* **目标SDK版本**: 34

* **Java版本**: 11

* **Kotlin编译器扩展版本**: 1.5.1

## 9. 开发和部署指南

### 9.1 开发环境要求

* Android Studio Hedgehog | 2023.1.1 或更高版本

* JDK 11 或更高版本

* Android SDK 34

* Kotlin 1.9.0

### 9.2 项目运行步骤

1. 克隆项目到本地
2. 使用 Android Studio 打开项目
3. 等待 Gradle 同步完成
4. 连接 Android 设备或启动模拟器
5. 点击运行按钮或使用 `./gradlew installDebug`

### 9.3 项目特性

* ✅ 完整的剪刀石头布游戏逻辑

* ✅ 美观的 Material3 UI 设计

* ✅ 音效和动画支持

* ✅ 电子宠物系统

* ✅ 游戏统计和历史记录

* ✅ 本地数据持久化

* ✅ 响应式设计适配不同屏幕尺寸

## 10. 注意事项

1. **音频资源**: 所有音频文件已迁移到 `app/src/main/res/raw/` 目录
2. **数据库**: 使用 Room 数据库存储游戏记录，支持数据持久化
3. **设置存储**: 应用设置使用 SharedPreferences 存储
4. **动画**: 使用 Compose Animation APIs 实现流畅的动画效果
5. **架构**: 严格遵循 MVVM 架构模式，代码结构清晰易维护

